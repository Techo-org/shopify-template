{% schema %}
{
  "name": "Collection Slider",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    }
  ]
}
{% endschema %}

{% style %}
                    .carousel-container {
                      position: relative;
                      width: 100%;
                      max-width: 1200px;
                      margin: 0 auto;
                      padding: 60px 0;
                      overflow: hidden;
                    }

                    .carousel {
                      display: flex;
                      align-items: center;
                      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                      gap: 30px;
               padding: 20px 40px;
                    }

                 .carousel-item {
                      flex:0 0 280px;
                      height: 350px;
                      position: relative;
                      cursor: pointer;
                       display:flex;

                      border-radius: 10px;
                      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                      transform-origin: center;
                      justify-content: center;
                      align-items: center;
                      margin: 0 auto;
                      color: white;

                      font-family: Arial, sans-serif;
                      font-size: 18px;
                      overflow: hidden;
                      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);

                    }

                    /* Animated Border Layer 1 */
             .carousel-item .animated-border {
                      height: 350px;
                      position: relative;
                      cursor: pointer;
                      display: flex;
                      border-radius: 10px;
               background:rgb(128,128,128,0.025);
                      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                      transform-origin: center;
                      justify-content: center;
                      align-items: center;
                      margin: 0 auto;
                      color: white;
                      z-index: 1;
               padding:3px;
                      font-family: Arial, sans-serif;
                      font-size: 18px;
                      overflow: hidden;
                      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                      width: 100%;
                    }

                    .carousel-item:hover {
                      box-shadow: 0 8px 30px rgb(0 0 0 / 50%);

                    }

                    @property --angle {
                      syntax: "<angle>";
                      initial-value: 0deg;
                      inherits: false;
                    }


                   .carousel-item:hover  .animated-border::before,  .carousel-item:hover .animated-border::after {
                      content: '';
                      position: absolute;
                      height: 100%;
                      width: 100%;
                      background-image: conic-gradient(from var(--angle), rgb(192,192,192),white 270deg);
                      top: 50%;
                      left: 50%;
                      translate: -50% -50%;
                      z-index: 1;
                      padding: 6px;
                      border-radius: 10px;
                      animation: 3s spin linear infinite;
                    }

                    .animated-border:hover::before {
                      filter: blur(1.5rem);
                      opacity: 0.5;
                    }

                    @keyframes spin {
                      from {
                        --angle: 0deg;
                      }
                      to {
                        --angle: 360deg;
                      }
                    }

              /* shining effect layer 2  */


                  .carousel-item-inner {
                      position: relative;
                      width: 100%;
                       z-index:2;
                      height: 100%;
                      overflow: hidden;
                      border-radius: 12px;

                    }

                    .carousel-item:hover .carousel-item-inner::before {
                      animation: shine 2s ease-in-out infinite;
                      opacity: 1;
                    }

                    .carousel-item:not(:hover) .carousel-item-inner::before {
                      opacity: 0;
                      animation: none;
                    }

                    .carousel-item-inner::before {
                      display: none;
                    }

                    .carousel-item:hover .carousel-item-inner::before {
                      content: '';
                      position: absolute;
                      top: 0;
                      left: -100%;
                      width: 300%;
                      height: 200%;
                      background: linear-gradient(
                        90deg,
                        transparent 10%,
                        rgba(255,255,255,0) 20%,
                        rgba(255,255,255,0.9) 25%,
                        transparent 30%,
                        transparent 35%,
                        rgba(255,255,255,0.9) 40%,
                        transparent 45%,
                        transparent 50%,
                        rgba(255,255,255,0.9) 55%,
                        transparent 60%
                      );
                      transform: skew(-45deg);
                      z-index: 3;
                      animation: shine 4s ease-in-out infinite;
                      opacity: 1;
                      display: block;
                    }

                    @keyframes shine {
                      0% {
                        transform: translate(-100%, -100%) skew(-45deg);
                      }
                      100% {
                        transform: translate(100%, 100%) skew(-45deg);
                      }
                    }

                /* border animation layer 3 */

    .carousel-item .grain {
        position: relative; /* Add this */
        height: 100%;

       width:100%;
        overflow: hidden;

      z-index:2;
    }

                    .carousel-item .grain::after {
                      content: "";
                      top: 0;
                      left: 0;
                      width: 500%;
                      height: 500%;
                      z-index:2;
                      position: absolute;
                      background-image: url('https://upload.wikimedia.org/wikipedia/commons/5/5c/Image_gaussian_noise_example.png');
                      opacity: 0.15;
                      transition: opacity 0.3s ease;
                      pointer-events: none;
                      animation: noise 1s steps(2) infinite;
                    }

                    .carousel-item:hover .grain::after {
                      content: "";
                      top: 0;
                      left: 0;
                      width: 500%;
                      height: 500%;
                      z-index: 2;
                      position: absolute;
                      background-image: url('https://upload.wikimedia.org/wikipedia/commons/5/5c/Image_gaussian_noise_example.png');
                      opacity: 0.15;
                      transition: opacity 0.3s ease;
                      pointer-events: none;
                      animation: noise 1s steps(2) infinite;
                    }

                   @keyframes noise {
             0% { transform: translate3d(0,-9rem,0) perspective(0) }
             10% { transform: translate3d(-1rem,-4rem,0) perspective(0) }
             20% { transform: translate3d(-8rem,-2rem,0) perspective(0) }
             30% { transform: translate3d(-9rem,-9rem,0) perspective(0) }
             40% { transform: translate3d(-2rem,-7rem,0) perspective(0) }
             50% { transform: translate3d(-9rem,-4rem,0) perspective(0) }
             60% { transform: translate3d(-2rem,-6rem,0) perspective(0) }
             70% { transform: translate3d(-7rem,-8rem,0) perspective(0) }
             80% { transform: translate3d(-9rem,-1rem,0) perspective(0) }
             90% { transform: translate3d(-6rem,-5rem,0) perspective(0) }
             to { transform: translate3d(-7rem,0,0) perspective(0) }
           }




    .carousel-item .animated-border,
    .carousel-item-inner,
    .carousel-item .grain {
      width: 100%;
      height: 100%;
      display: flex;
      position: relative;
    }




          .carousel-item.active {
                      flex: 0 0 350px;
                      height: 420px;


                    }



                    .carousel-item .carousel-image {
                      width: 100%;
                      height: 100%;
                      object-fit: cover;
                      transition: transform 0.5s ease;
                        transform-origin:center;
                    }

        .
                    .carousel-item.active .carousel-image {
    width: 100%;
    height: 100%;
  }

  /* Fix hover transform */
  .carousel-item:hover .carousel-image {
    transform: scale(1.15) rotate(-6deg);
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
                    .carousel-text {
                      position: absolute;
                      bottom: 30px;
                      left: 30px;
                      color: white;
                      transform: translateY(100px) translateX(-50px);
                      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);

                    }

                    .carousel-item:hover .carousel-text {
                      transform: translateY(0) translateX(0);
                    }

                    .carousel-text h3 {
                      font-size: 24px;
                      font-weight: 600;
                      margin: 0;
                      color: white;
                      line-height: 1.2;

                    }

                    .carousel-nav {
                      position: absolute;
                      top: 50%;
                      transform: translateY(-50%);
                      width: 50px;
                      height: 50px;
                      background: white;
                      border: none;
                      border-radius: 50%;
                      cursor: pointer;
                      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                      z-index: 25;
                      transition: all 0.3s ease;
                    }

                    .carousel-nav:hover {
                      background: #f8f8f8;
                      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                    }

                    .carousel-prev {
                      left: 20px;
                    }

                    .carousel-next {
                      right: 20px;
                    }

                    .carousel-page-text {
                      position: absolute;
                      bottom: 27px;
                      right: 30px;
                      color: white;
                      transform: translateY(100px) translateX(50px);
                      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);

                    }

                    .carousel-item:hover .carousel-page-text {
                      transform: translateY(0) translateX(0);
                    }

                    /* Media Queries */
                    @media (min-width: 768px) {
                      .carousel {
                        gap: 20px;
                      }

                      .carousel-item {
                        flex: 0 0 280px;
                        height: 350px;
                      }

                      .carousel-item.active {
                        flex: 0 0 350px;
                        height: 420px;
                      }
                    }

                    @media (max-width: 480px) {
                      .carousel-container {
                        padding: 30px 0;
                      }

                      .carousel {
                        gap: 10px;
                        padding: 5px;
                      }

                      .carousel-item {
                        flex: 0 0 160px;
                        height: 220px;
                      }

                      .carousel-item.active {
                        flex: 0 0 200px;
                        height: 260px;
                      }

                      .carousel-nav {
                        width: 35px;
                        height: 35px;
                      }

                      .carousel-text h3 {
                        font-size: 18px;
                      }
                      .carousel-item.active .carousel-image {
    width: 100%;
    height: 100%;
  }
                    }
{% endstyle %}

<div class="carousel-container">
  <div class="carousel" id="productCarousel">
    {% for product in collections[section.settings.collection].products %}
      <div class="carousel-item {% if forloop.index == 3 %}active{% endif %}" data-index="{{ forloop.index0 }}">
        <div class="animated-border">
          <div class="carousel-item-inner">
            <div class="grain">
              <img
                src="{{ product.featured_image | img_url: '800x' }}"
                alt="{{ product.title }}"
                class="carousel-image"
                loading="lazy"
              >
              <div class="carousel-text">
                <h3>{{ product.title }}</h3>
              </div>
              <div class="carousel-page-text">
                <span style="font-size: 20px;">&#8594;</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <button class="carousel-nav carousel-prev" aria-label="Previous">&lt;</button>
  <button class="carousel-nav carousel-next" aria-label="Next">&gt;</button>
</div>

{% javascript %}
class Carousel {
  constructor() {
    this.carousel = document.getElementById('productCarousel');
    this.items = Array.from(this.carousel.getElementsByClassName('carousel-item'));
    this.prevBtn = document.querySelector('.carousel-prev');
    this.nextBtn = document.querySelector('.carousel-next');
    this.itemWidth = window.innerWidth >= 768 ? 280 : 200;
    this.activeItemWidth = window.innerWidth >= 768 ? 350 : 250;
    this.originalCount = this.items.length;
    
    this.cloneItems();
    this.currentIndex = this.originalCount;
    this.init();
  }

  cloneItems() {
    const itemsArray = Array.from(this.items);
    
    itemsArray.forEach(item => {
      const clone = item.cloneNode(true);
      this.carousel.insertBefore(clone, this.carousel.firstChild);
    });
    
    itemsArray.forEach(item => {
      const clone = item.cloneNode(true);
      this.carousel.appendChild(clone);
    });
    
    this.items = Array.from(this.carousel.getElementsByClassName('carousel-item'));
    this.totalItems = this.items.length;
  }

  init() {
    this.prevBtn.addEventListener('click', () => this.prev());
    this.nextBtn.addEventListener('click', () => this.next());
    
    this.items.forEach((item, index) => {
      item.addEventListener('click', () => this.goToSlide(index));
    });

    this.updateSlide(this.currentIndex);
    
    this.carousel.addEventListener('transitionend', () => this.handleTransitionEnd());
  }

  updateSlide(index, animate = true) {
    this.items.forEach(item => item.classList.remove('active'));
    this.items[index].classList.add('active');
    
    const container = this.carousel.parentElement;
    const containerWidth = container.offsetWidth;
    const itemCenter = this.items[index].offsetLeft + (this.itemWidth / 2);
    const offset = itemCenter - (containerWidth / 2);
    
    this.carousel.style.transition = animate ? 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)' : 'none';
    this.carousel.style.transform = `translateX(-${offset}px)`;
    
    this.currentIndex = index;
  }

  handleTransitionEnd() {
    if (this.currentIndex >= this.totalItems - this.originalCount) {
      this.updateSlide(this.currentIndex - this.originalCount, false);
    } else if (this.currentIndex < this.originalCount) {
      this.updateSlide(this.currentIndex + this.originalCount, false);
    }
  }

  goToSlide(index) {
    if (index < 0) index = this.totalItems - 1;
    if (index >= this.totalItems) index = 0;
    
    this.updateSlide(index);
  }

  next() {
    this.goToSlide(this.currentIndex + 1);
  }

  prev() {
    this.goToSlide(this.currentIndex - 1);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  let carousel = new Carousel();
  
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      carousel = new Carousel();
    }, 250);
  });
});
{% endjavascript %}
